<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding Decimals: Metric Units & Simulations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'media',
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* --- Base Styles --- */
        .fraction { display: inline-block; text-align: center; vertical-align: middle; margin: 0 0.2em; font-weight: bold; }
        .fraction > span { display: block; padding: 0 0.1em; }
        .fraction span.denominator { border-top: 1px solid currentColor; }
        .error-message { color: #ef4444; text-align: center; margin-top: 0.5rem; font-weight: 500; min-height: 1.5rem; } /* Common error style */
        .explanation-box { background-color: #f9fafb; padding: 1rem; border-radius: 0.375rem; margin-top: 1rem; }
        .algorithm-box { font-family: monospace; white-space: pre; background-color: #f3f4f6; padding: 1rem; border-radius: 0.375rem; margin-top: 1rem; overflow-x: auto; text-align: right; }
        .input-group { display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem; }
        .number-input { border: 1px solid #d1d5db; border-radius: 0.375rem; padding: 0.5rem; text-align: center; }

        /* --- Sim 1 Styles --- */
        .ruler { height: 50px; background-color: #f3f4f6; border: 1px solid #d1d5db; position: relative; border-radius: 0.375rem; overflow: hidden; margin-top: 1rem; margin-bottom: 1rem; }
        .cm-marker { position: absolute; bottom: 0; width: 2px; background-color: #1f2937; height: 25px; }
        .mm-marker { position: absolute; bottom: 0; width: 1px; background-color: #6b7280; height: 15px; }
        .cm-label { position: absolute; bottom: 28px; font-size: 0.75rem; color: #1f2937; transform: translateX(-50%); }
        .highlight-bar { position: absolute; left: 0; top: 0; bottom: 0; background-color: rgba(59, 130, 246, 0.5); border-right: 2px solid #2563eb; transition: width 0.3s ease; border-radius: 0.375rem 0 0 0.375rem; }
        input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; background: #d1d5db; outline: none; opacity: 0.7; -webkit-transition: .2s; transition: opacity .2s; border-radius: 9999px; cursor: pointer; }
        input[type=range]:hover { opacity: 1; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: #3b82f6; cursor: pointer; border-radius: 50%; }
        input[type=range]::-moz-range-thumb { width: 20px; height: 20px; background: #3b82f6; cursor: pointer; border-radius: 50%; border: none; }
        .pie-chart-container { margin-top: 1.5rem; text-align: center; }
        .pie-chart-svg { display: inline-block; width: 150px; height: 150px; }
        .pie-slice { stroke: #ffffff; stroke-width: 1; transition: fill 0.3s ease; }
        .pie-slice-selected { fill: #8b5cf6; }
        .pie-slice-remainder { fill: #d1d5db; }

        /* --- Sim 2 Styles --- */
        .sim2-input { width: 60px; } /* Specific width */
        .sim2-viz-container { margin-top: 1rem; padding: 1rem; background-color: #f9fafb; border-radius: 0.375rem; min-height: 80px; display: flex; flex-wrap: wrap; gap: 10px; align-items: flex-start;}
        .sim2-bar { border: 1px solid #6b7280; height: 50px; background-color: #ffffff; display: flex; }
        .sim2-bar-segment { height: 100%; border-right: 1px dashed #9ca3af; }
        .sim2-bar-segment:last-child { border-right: none; }
        .sim2-bar-segment-filled { background-color: #22c55e; }
        .sim2-bar-segment-empty { background-color: #e5e7eb; }

        /* --- Sim 3 & 4 & 5 Styles --- */
        .sim-input { width: 100px; } /* Consistent width for Sim 3, 4, 5 */


        /* --- Dark Mode Overrides --- */
        @media (prefers-color-scheme: dark) {
            .error-message { color: #f87171; } /* red-400 */
            .explanation-box { background-color: #1f2937; } /* gray-800 */
            .algorithm-box { background-color: #374151; color: #f3f4f6; } /* gray-700, gray-100 */
            .number-input { border-color: #4b5563; background-color: #374151; color: #f9fafb; } /* gray-600, gray-700, gray-50 */

            /* Sim 1 */
            .ruler { background-color: #374151; border-color: #4b5563; }
            .cm-marker { background-color: #f3f4f6; } .mm-marker { background-color: #9ca3af; } .cm-label { color: #f3f4f6; }
            .highlight-bar { background-color: rgba(96, 165, 250, 0.5); border-right-color: #3b82f6; }
            input[type=range] { background: #4b5563; } input[type=range]::-webkit-slider-thumb { background: #60a5fa; } input[type=range]::-moz-range-thumb { background: #60a5fa; }
            .pie-slice { stroke: #1f2937; } .pie-slice-selected { fill: #a78bfa; } .pie-slice-remainder { fill: #4b5563; }

            /* Sim 2 */
            .sim2-viz-container { background-color: #1f2937; }
            .sim2-bar { border-color: #4b5563; background-color: #374151; }
            .sim2-bar-segment { border-right-color: #4b5563; } .sim2-bar-segment-filled { background-color: #4ade80; } .sim2-bar-segment-empty { background-color: #4b5563; }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 p-6 md:p-10 transition-colors duration-300">

    <div class="max-w-4xl mx-auto bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md">

        <h1 class="text-3xl font-bold text-blue-600 dark:text-blue-400 mb-6 text-center">Understanding Decimals with Metric Units</h1>

        <section class="mb-8 p-4 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800/50">
            <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-300 mb-3">What are Decimals?</h2>
            <p class="text-lg leading-relaxed text-gray-700 dark:text-gray-300">
                Decimals are a way of writing numbers that are not whole numbers. They use a <strong class="text-blue-600 dark:text-blue-400">decimal point (.)</strong> to separate the whole number part from the fractional part. The digits to the right of the decimal point represent fractions with denominators that are powers of 10 (like 10, 100, 1000, etc.).
            </p>
            <p class="text-lg leading-relaxed mt-2 text-gray-700 dark:text-gray-300">
                For example, <code class="bg-gray-200 dark:bg-gray-600 dark:text-gray-100 px-1 rounded">0.5</code> represents half (1/2), <code class="bg-gray-200 dark:bg-gray-600 dark:text-gray-100 px-1 rounded">0.25</code> represents a quarter (1/4), and <code class="bg-gray-200 dark:bg-gray-600 dark:text-gray-100 px-1 rounded">1.75</code> represents one and three-quarters (1 3/4).
            </p>
        </section>

        <section class="mb-8">
             <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-300 mb-4">Metric Units and Powers of 1000</h2>
             <p class="text-lg mb-4 leading-relaxed text-gray-700 dark:text-gray-300">The metric system is based on powers of 10, which makes it work very well with decimals. Let's look at units of length, using the <strong class="text-blue-600 dark:text-blue-400">meter (m)</strong> as our base unit. Prefixes tell us whether we are multiplying or dividing the base unit, often by powers of 1000.</p>
             <div class="mb-6 p-4 border border-green-200 dark:border-green-800 rounded-lg bg-green-50 dark:bg-green-900/30 text-gray-700 dark:text-gray-300">
                 <h3 class="text-xl font-semibold text-green-700 dark:text-green-400 mb-2">Multiples (Getting Bigger)</h3>
                 <ul class="list-disc list-inside space-y-2 text-lg">
                     <li><strong>Kilometer (km):</strong> 1 km = 1,000 meters (1 x 10<sup>3</sup> m)</li>
                     <li><strong>Megameter (Mm):</strong> 1 Mm = 1,000 kilometers = 1,000,000 meters (1 x 10<sup>6</sup> m)</li>
                     <li><strong>Gigameter (Gm):</strong> 1 Gm = 1,000 Megameters = 1,000,000,000 meters (1 x 10<sup>9</sup> m)</li>
                 </ul>
             </div>
             <div class="p-4 border border-red-200 dark:border-red-800 rounded-lg bg-red-50 dark:bg-red-900/30 text-gray-700 dark:text-gray-300">
                 <h3 class="text-xl font-semibold text-red-700 dark:text-red-400 mb-2">Fractions (Getting Smaller)</h3>
                  <ul class="list-disc list-inside space-y-2 text-lg">
                     <li><strong>Millimeter (mm):</strong> 1 mm = 1/1,000 meter = 0.001 meters (1 x 10<sup>-3</sup> m)</li>
                     <li><strong>Micrometer (µm):</strong> 1 µm = 1/1,000 millimeter = 1/1,000,000 meter = 0.000001 meters (1 x 10<sup>-6</sup> m)</li>
                     <li><strong>Nanometer (nm):</strong> 1 nm = 1/1,000 micrometer = 1/1,000,000,000 meter = 0.000000001 meters (1 x 10<sup>-9</sup> m)</li>
                 </ul>
                  <p class="text-lg mt-3">Notice how each step down is 1/1000th of the previous one.</p>
             </div>
        </section>

        <section class="mt-10 p-6 border border-blue-200 dark:border-blue-800 rounded-lg bg-blue-50 dark:bg-blue-900/30">
            <h2 class="text-2xl font-semibold text-blue-700 dark:text-blue-400 mb-4 text-center">Simulation 1: Centimeters & Millimeters (1/10ths)</h2>
             <p class="text-lg mb-4 text-center leading-relaxed text-gray-700 dark:text-gray-300">Visualize how millimeters relate to centimeters...</p>
             <div class="mb-4"> <label for="mmSlider" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">Select Millimeters (0 to 10 mm):</label> <input type="range" id="mmSlider" name="mmSlider" min="0" max="10" value="3" class="w-full"> <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mt-1"><span>0 mm</span><span>5 mm</span><span>10 mm (1 cm)</span></div> </div>
             <div class="flex flex-col md:flex-row md:space-x-6 items-center justify-center"> <div class="w-full md:w-2/3 mb-4 md:mb-0"> <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2 text-center">Ruler (0 to 1 cm)</h3> <div class="ruler" id="rulerViz"><div id="highlight" class="highlight-bar" style="width: 30%;"></div></div> </div> <div class="w-full md:w-1/3 pie-chart-container"> <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2 text-center">Fraction Visualized</h3> <svg id="pieChart" class="pie-chart-svg" viewBox="0 0 100 100" aria-labelledby="pieTitle" role="img"><title id="pieTitle">Pie chart showing fraction of a centimeter</title></svg> </div> </div>
             <div class="mt-6 text-center bg-white dark:bg-gray-700 p-4 rounded-md shadow-sm border border-gray-200 dark:border-gray-600"> <p class="text-xl font-semibold flex items-center justify-center flex-wrap space-x-2 text-gray-800 dark:text-gray-200"> <span id="mmValue" class="text-red-600 dark:text-red-400 font-bold">3</span> mm = <span class="fraction text-purple-600 dark:text-violet-400"><span id="numerator">3</span><span class="denominator">10</span></span> cm = <span id="cmValue" class="text-blue-600 dark:text-blue-400 font-bold">0.3</span> cm </p> </div>
        </section>

        <section class="mt-10 p-6 border border-green-200 dark:border-green-800 rounded-lg bg-green-50 dark:bg-green-900/30">
            <h2 class="text-2xl font-semibold text-green-700 dark:text-green-400 mb-4 text-center">Simulation 2: Fraction to Decimal Conversion</h2>
            <p class="text-lg mb-4 text-center leading-relaxed text-gray-700 dark:text-gray-300">Enter any fraction...</p>
            <div class="input-group sim2-input-group"> <label for="numeratorInput2" class="sr-only">Numerator</label> <input type="number" id="numeratorInput2" value="25" min="0" class="number-input sim2-input" aria-label="Numerator"> <span class="text-2xl font-bold text-gray-700 dark:text-gray-300"> / </span> <label for="denominatorInput2" class="sr-only">Denominator</label> <input type="number" id="denominatorInput2" value="10" min="1" class="number-input sim2-input" aria-label="Denominator"> </div>
            <div id="sim2ErrorMsg" class="sim2-error error-message"></div>
            <div class="mt-4 text-center bg-white dark:bg-gray-700 p-4 rounded-md shadow-sm border border-gray-200 dark:border-gray-600"> <p class="text-xl font-semibold flex items-center justify-center flex-wrap space-x-2 text-gray-800 dark:text-gray-200"> <span class="fraction text-green-600 dark:text-green-400"><span id="sim2NumeratorDisplay">25</span><span class="denominator" id="sim2DenominatorDisplay">10</span></span> = <span id="sim2DecimalResult" class="text-blue-600 dark:text-blue-400 font-bold">2.5</span> </p> </div>
            <div class="mt-4"> <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2 text-center">Visual Representation</h3> <div id="sim2VizContainer" class="sim2-viz-container dark:bg-gray-900/50"></div> <p class="text-xs text-center text-gray-500 dark:text-gray-400 mt-2">Each bar represents one whole unit...</p> </div>
        </section>

        <section class="mt-10 p-6 border border-purple-200 dark:border-purple-800 rounded-lg bg-purple-50 dark:bg-purple-900/30">
            <h2 class="text-2xl font-semibold text-purple-700 dark:text-purple-400 mb-4 text-center">Simulation 3: Adding Decimals</h2>
            <p class="text-lg mb-4 text-center leading-relaxed text-gray-700 dark:text-gray-300">Enter two decimal numbers to see how they are added...</p>
            <div class="input-group sim3-input-group"> <label for="decimalInputA" class="sr-only">First Decimal</label> <input type="text" inputmode="decimal" id="decimalInputA" value="1.75" class="number-input sim-input" aria-label="First Decimal"> <span class="text-2xl font-bold text-gray-700 dark:text-gray-300"> + </span> <label for="decimalInputB" class="sr-only">Second Decimal</label> <input type="text" inputmode="decimal" id="decimalInputB" value="0.5" class="number-input sim-input" aria-label="Second Decimal"> </div>
             <div id="sim3ErrorMsg" class="sim3-error error-message"></div>
            <div class="mt-4 space-y-6"> <div class="explanation-box dark:bg-gray-800/50 text-gray-700 dark:text-gray-300"> <h3 class="text-lg font-semibold text-purple-600 dark:text-purple-400 mb-2">Adding as Decimals...</h3> <p class="mb-2">To add decimals, we line up...</p> <div id="algorithmDisplay3" class="algorithm-box dark:bg-gray-700 dark:text-gray-100"></div> </div> <div class="explanation-box dark:bg-gray-800/50 text-gray-700 dark:text-gray-300"> <h3 class="text-lg font-semibold text-purple-600 dark:text-purple-400 mb-2">Adding as Fractions</h3> <p class="mb-2">Decimals can be written as fractions...</p> <ol class="list-decimal list-inside space-y-1 mb-2"><li>Convert each decimal to a fraction.</li><li>Find a common denominator for the fractions.</li><li>Convert each fraction to an equivalent fraction with the common denominator.</li><li>Add the numerators, keeping the common denominator.</li><li>Simplify the resulting fraction if possible.</li></ol> <div id="fractionProblemDisplay3" class="text-center font-semibold text-lg"></div> </div> <div class="mt-6 text-center bg-white dark:bg-gray-700 p-4 rounded-md shadow-sm border border-gray-200 dark:border-gray-600"> <p class="text-xl font-semibold text-gray-800 dark:text-gray-200"> Result: <span id="resultDisplay3" class="text-purple-700 dark:text-purple-400 font-bold"></span> <span class="text-base">(or <span id="resultFractionDisplay3" class="text-green-600 dark:text-green-400 font-bold"></span> as a simplified fraction)</span> </p> </div> </div>
        </section>

        <section class="mt-10 p-6 border border-teal-200 dark:border-teal-800 rounded-lg bg-teal-50 dark:bg-teal-900/30">
            <h2 class="text-2xl font-semibold text-teal-700 dark:text-teal-400 mb-4 text-center">Simulation 4: Multiplying Decimals</h2>
            <p class="text-lg mb-4 text-center leading-relaxed text-gray-700 dark:text-gray-300">Enter two decimal numbers to see how they are multiplied...</p>
            <div class="input-group sim4-input-group"> <label for="decimalInputC" class="sr-only">First Decimal</label> <input type="text" inputmode="decimal" id="decimalInputC" value="1.5" class="number-input sim-input" aria-label="First Decimal"> <span class="text-2xl font-bold text-gray-700 dark:text-gray-300"> x </span> <label for="decimalInputD" class="sr-only">Second Decimal</label> <input type="text" inputmode="decimal" id="decimalInputD" value="0.25" class="number-input sim-input" aria-label="Second Decimal"> </div>
             <div id="sim4ErrorMsg" class="sim4-error error-message"></div>
            <div class="mt-4 space-y-6"> <div class="explanation-box dark:bg-gray-800/50 text-gray-700 dark:text-gray-300"> <h3 class="text-lg font-semibold text-teal-600 dark:text-teal-400 mb-2">Multiplying as Decimals...</h3> <ol class="list-decimal list-inside space-y-1 mb-2"><li>Multiply the numbers as if they were whole numbers (ignore the decimal points initially).</li><li>Count the total number of decimal places in both original numbers (factors).</li><li>Place the decimal point in the product so that it has the same total number of decimal places counted in step 2.</li></ol> <p class="mb-2">Example:</p> <div id="algorithmDisplay4" class="algorithm-box dark:bg-gray-700 dark:text-gray-100"></div> </div> <div class="explanation-box dark:bg-gray-800/50 text-gray-700 dark:text-gray-300"> <h3 class="text-lg font-semibold text-teal-600 dark:text-teal-400 mb-2">Multiplying as Fractions</h3> <p class="mb-2">To multiply decimals as fractions:</p> <ol class="list-decimal list-inside space-y-1 mb-2"><li>Convert each decimal to a fraction.</li><li>Multiply the numerators together.</li><li>Multiply the denominators together.</li><li>Simplify the resulting fraction if possible.</li></ol> <div id="fractionProblemDisplay4" class="text-center font-semibold text-lg"></div> </div> <div class="mt-6 text-center bg-white dark:bg-gray-700 p-4 rounded-md shadow-sm border border-gray-200 dark:border-gray-600"> <p class="text-xl font-semibold text-gray-800 dark:text-gray-200"> Result: <span id="resultDisplay4" class="text-teal-700 dark:text-teal-400 font-bold"></span> <span class="text-base">(or <span id="resultFractionDisplay4" class="text-green-600 dark:text-green-400 font-bold"></span> as a simplified fraction)</span> </p> </div> </div>
        </section>

        <section class="mt-10 p-6 border border-amber-200 dark:border-amber-800 rounded-lg bg-amber-50 dark:bg-amber-900/30">
            <h2 class="text-2xl font-semibold text-amber-700 dark:text-amber-400 mb-4 text-center">Simulation 5: Dividing Decimals</h2>
            <p class="text-lg mb-4 text-center leading-relaxed text-gray-700 dark:text-gray-300">
                Enter two decimal numbers (dividend and divisor) to see how they are divided.
            </p>
            <div class="input-group sim5-input-group"> <label for="decimalInputE" class="sr-only">Dividend</label> <input type="text" inputmode="decimal" id="decimalInputE" value="2.25" class="number-input sim-input" aria-label="Dividend"> <span class="text-2xl font-bold text-gray-700 dark:text-gray-300"> ÷ </span> <label for="decimalInputF" class="sr-only">Divisor</label> <input type="text" inputmode="decimal" id="decimalInputF" value="0.5" class="number-input sim-input" aria-label="Divisor"> </div>
             <div id="sim5ErrorMsg" class="sim5-error error-message"></div>
            <div class="mt-4 space-y-6"> <div class="explanation-box dark:bg-gray-800/50 text-gray-700 dark:text-gray-300"> <h3 class="text-lg font-semibold text-amber-600 dark:text-amber-400 mb-2">Dividing as Decimals...</h3> <ol class="list-decimal list-inside space-y-1 mb-2"><li>If the divisor (the number you are dividing by) is a decimal, move its decimal point to the right until it becomes a whole number.</li><li>Move the decimal point in the dividend (the number being divided) the same number of places to the right (add zeros if needed).</li><li>Place the decimal point for the answer (quotient) directly above the new position of the decimal point in the dividend.</li><li>Perform long division as you would with whole numbers.</li></ol> <p class="mb-2">Example:</p> <div id="algorithmDisplay5" class="algorithm-box dark:bg-gray-700 dark:text-gray-100"></div> </div> <div class="explanation-box dark:bg-gray-800/50 text-gray-700 dark:text-gray-300"> <h3 class="text-lg font-semibold text-amber-600 dark:text-amber-400 mb-2">Dividing as Fractions</h3> <p class="mb-2">To divide decimals as fractions:</p> <ol class="list-decimal list-inside space-y-1 mb-2"><li>Convert each decimal to a fraction.</li><li>Multiply the first fraction (dividend) by the reciprocal (flipped version) of the second fraction (divisor).</li><li>Multiply the numerators and denominators.</li><li>Simplify the resulting fraction if possible.</li></ol> <div id="fractionProblemDisplay5" class="text-center font-semibold text-lg"></div> </div> <div class="mt-6 text-center bg-white dark:bg-gray-700 p-4 rounded-md shadow-sm border border-gray-200 dark:border-gray-600"> <p class="text-xl font-semibold text-gray-800 dark:text-gray-200"> Result: <span id="resultDisplay5" class="text-amber-700 dark:text-amber-400 font-bold"></span> <span class="text-base">(or <span id="resultFractionDisplay5" class="text-green-600 dark:text-green-400 font-bold"></span> as a simplified fraction)</span> </p> <p id="roundingNote5" class="text-xs text-gray-500 dark:text-gray-400 mt-1"></p> </div> </div>
        </section>

    </div>
    <footer class="mt-10 py-4">
        <p class="text-center text-sm text-gray-500 dark:text-gray-400">
            &copy; <span id="copyright-year"></span> NakedCircuits All rights reserved.
        </p>
    </footer>
    <script>
        // --- Helper Functions ---
        function gcd(a, b) { a = Math.abs(a); b = Math.abs(b); return b === 0 ? a : gcd(b, a % b); }
        function getDecimalPlaces(numStr) { if (String(numStr).includes('.')) { const parts = String(numStr).split('.'); return parts[1] ? parts[1].length : 0; } return 0; }

        // --- Simulation 1: cm/mm ---
        const slider = document.getElementById('mmSlider');
        const pieSlices = []; const numSlices = 10;
        function getArcPath(sliceIndex, totalSlices, radius = 45, centerX = 50, centerY = 50) { const startAngle = (sliceIndex / totalSlices) * 360; const endAngle = ((sliceIndex + 1) / totalSlices) * 360; const startRad = (startAngle - 90) * Math.PI / 180; const endRad = (endAngle - 90) * Math.PI / 180; const startX = centerX + radius * Math.cos(startRad); const startY = centerY + radius * Math.sin(startRad); const endX = centerX + radius * Math.cos(endRad); const endY = centerY + radius * Math.sin(endRad); const largeArcFlag = (endAngle - startAngle) <= 180 ? "0" : "1"; return [`M ${centerX},${centerY}`,`L ${startX},${startY}`,`A ${radius},${radius} 0 ${largeArcFlag} 1 ${endX},${endY}`,`L ${centerX},${centerY}`].join(" "); }
        function drawPieSlices() { const pieChartSVG = document.getElementById('pieChart'); if (!pieChartSVG) return; const pieTitle = document.getElementById('pieTitle'); pieChartSVG.innerHTML = ''; if(pieTitle) pieChartSVG.appendChild(pieTitle); for (let i = 0; i < numSlices; i++) { const slicePath = document.createElementNS("http://www.w3.org/2000/svg", "path"); slicePath.setAttribute("d", getArcPath(i, numSlices)); slicePath.setAttribute("class", "pie-slice"); slicePath.setAttribute("id", `pie-slice-${i}`); pieChartSVG.appendChild(slicePath); pieSlices[i] = slicePath; } if (slider) updatePieChartColors(parseInt(slider.value)); }
        function updatePieChartColors(mm) { const pieTitle = document.getElementById('pieTitle'); if(pieTitle) pieTitle.textContent = `Pie chart showing ${mm} out of 10 parts selected.`; pieSlices.forEach((slice, index) => { if(slice) slice.setAttribute("class", index < mm ? "pie-slice pie-slice-selected" : "pie-slice pie-slice-remainder"); }); }
        function updateSim1Values() { if (!slider) return; const mmValueDisplay = document.getElementById('mmValue'); const cmValueDisplay = document.getElementById('cmValue'); const numeratorDisplay = document.getElementById('numerator'); const highlightBar = document.getElementById('highlight'); const mm = parseInt(slider.value); const cm = mm / 10.0; if(mmValueDisplay) mmValueDisplay.textContent = mm; if(cmValueDisplay) cmValueDisplay.textContent = cm.toFixed(1); if(numeratorDisplay) numeratorDisplay.textContent = mm; if(highlightBar) highlightBar.style.width = `${mm * 10}%`; updatePieChartColors(mm); }
        function drawRuler() { const rulerViz = document.getElementById('rulerViz'); const highlightBar = document.getElementById('highlight'); if (!rulerViz || !highlightBar) return; rulerViz.innerHTML = ''; rulerViz.appendChild(highlightBar); for (let cm = 0; cm <= 1; cm++) { const pos = cm * 100; const mark = document.createElement('div'); mark.className = 'cm-marker'; mark.style.left = (pos === 100) ? `calc(100% - 2px)` : `${pos}%`; rulerViz.appendChild(mark); const lbl = document.createElement('div'); lbl.className = 'cm-label'; lbl.textContent = cm; lbl.style.left = (pos === 100) ? `calc(100% - 10px)` : (pos === 0 ? '10px' : `${pos}%`); rulerViz.appendChild(lbl); } for (let mm = 1; mm < 10; mm++) { const pos = mm * 10; const mark = document.createElement('div'); mark.className = 'mm-marker'; mark.style.left = `${pos}%`; rulerViz.appendChild(mark); } }
        if(slider) slider.addEventListener('input', updateSim1Values);


        // --- Simulation 2: Fraction to Decimal ---
        const numeratorInput2 = document.getElementById('numeratorInput2');
        const denominatorInput2 = document.getElementById('denominatorInput2');
        const MAX_DENOMINATOR_VIZ = 20;
        function drawVisualisation2(wholePart, fractionalNumerator, denominator) { const sim2VizContainer = document.getElementById('sim2VizContainer'); if (!sim2VizContainer) return; sim2VizContainer.innerHTML = ''; if (denominator > MAX_DENOMINATOR_VIZ) { sim2VizContainer.innerHTML = `<p class="text-sm text-gray-600 dark:text-gray-400 text-center w-full">Visualization skipped for denominators larger than ${MAX_DENOMINATOR_VIZ}.</p>`; return; } if (denominator <= 0) return; const barWidth = 100; const segmentWidth = barWidth / denominator; for (let i = 0; i < wholePart; i++) { const wholeBar = document.createElement('div'); wholeBar.className = 'sim2-bar'; wholeBar.style.width = `${barWidth}px`; for (let j = 0; j < denominator; j++) { const segment = document.createElement('div'); segment.className = 'sim2-bar-segment sim2-bar-segment-filled'; segment.style.width = `${segmentWidth.toFixed(2)}px`; wholeBar.appendChild(segment); } sim2VizContainer.appendChild(wholeBar); } if (fractionalNumerator > 0 || (wholePart === 0 && fractionalNumerator === 0)) { const partialBar = document.createElement('div'); partialBar.className = 'sim2-bar'; partialBar.style.width = `${barWidth}px`; for (let j = 0; j < denominator; j++) { const segment = document.createElement('div'); segment.className = j < fractionalNumerator ? 'sim2-bar-segment sim2-bar-segment-filled' : 'sim2-bar-segment sim2-bar-segment-empty'; segment.style.width = `${segmentWidth.toFixed(2)}px`; partialBar.appendChild(segment); } if (fractionalNumerator > 0 || (wholePart === 0 && fractionalNumerator === 0)) { sim2VizContainer.appendChild(partialBar); } } }
        function updateSimulation2() { const sim2ErrorMsg = document.getElementById('sim2ErrorMsg'); const sim2NumeratorDisplay = document.getElementById('sim2NumeratorDisplay'); const sim2DenominatorDisplay = document.getElementById('sim2DenominatorDisplay'); const sim2DecimalResult = document.getElementById('sim2DecimalResult'); const sim2VizContainer = document.getElementById('sim2VizContainer'); if (!numeratorInput2 || !denominatorInput2 || !sim2ErrorMsg || !sim2NumeratorDisplay || !sim2DenominatorDisplay || !sim2DecimalResult || !sim2VizContainer) return; sim2ErrorMsg.textContent = ''; const numStr = numeratorInput2.value; const denStr = denominatorInput2.value; if (numStr.trim() === '' || denStr.trim() === '') { sim2VizContainer.innerHTML = ''; sim2DecimalResult.textContent = '-'; sim2NumeratorDisplay.textContent = '-'; sim2DenominatorDisplay.textContent = '-'; return; } const numerator = parseInt(numStr); const denominator = parseInt(denStr); if (isNaN(numerator) || isNaN(denominator) || denominator <= 0 || numerator < 0) { sim2ErrorMsg.textContent = 'Invalid input.'; sim2VizContainer.innerHTML = ''; return; } const decimalValue = numerator / denominator; const wholePart = Math.floor(decimalValue); const fractionalNumerator = numerator % denominator; sim2NumeratorDisplay.textContent = numerator; sim2DenominatorDisplay.textContent = denominator; sim2DecimalResult.textContent = decimalValue.toLocaleString(undefined, { maximumFractionDigits: 4 }); drawVisualisation2(wholePart, fractionalNumerator, denominator); }
        if(numeratorInput2) numeratorInput2.addEventListener('input', updateSimulation2);
        if(denominatorInput2) denominatorInput2.addEventListener('input', updateSimulation2);


        // --- Simulation 3: Adding Decimals ---
        const decimalInputA = document.getElementById('decimalInputA');
        const decimalInputB = document.getElementById('decimalInputB');
        function updateSimulation3() { const algorithmDisplay3 = document.getElementById('algorithmDisplay3'); const fractionProblemDisplay3 = document.getElementById('fractionProblemDisplay3'); const resultDisplay3 = document.getElementById('resultDisplay3'); const resultFractionDisplay3 = document.getElementById('resultFractionDisplay3'); const sim3ErrorMsg = document.getElementById('sim3ErrorMsg'); if (!decimalInputA || !decimalInputB || !sim3ErrorMsg || !algorithmDisplay3 || !fractionProblemDisplay3 || !resultDisplay3 || !resultFractionDisplay3) return; sim3ErrorMsg.textContent = ''; const valA = decimalInputA.value.trim(); const valB = decimalInputB.value.trim(); if (valA === '' || valB === '') { algorithmDisplay3.textContent = ''; fractionProblemDisplay3.textContent = ''; resultDisplay3.textContent = '-'; resultFractionDisplay3.textContent = '-/-'; return; } const numA = parseFloat(valA); const numB = parseFloat(valB); if (isNaN(numA) || isNaN(numB)) { sim3ErrorMsg.textContent = 'Please enter valid decimal numbers.'; algorithmDisplay3.textContent = ''; fractionProblemDisplay3.textContent = ''; resultDisplay3.textContent = '-'; resultFractionDisplay3.textContent = '-/-'; return; } const decimalSum = numA + numB; const dpA = getDecimalPlaces(valA); const dpB = getDecimalPlaces(valB); const maxDP = Math.max(dpA, dpB); const commonDenominator = Math.pow(10, maxDP); const intA = Math.round(numA * commonDenominator); const intB = Math.round(numB * commonDenominator); const numeratorSum = intA + intB; const commonDivisor = gcd(numeratorSum, commonDenominator); const simplifiedNumerator = numeratorSum / commonDivisor; const simplifiedDenominator = commonDenominator / commonDivisor; const numAStr = numA.toFixed(maxDP); const numBStr = numB.toFixed(maxDP); const sumStr = decimalSum.toFixed(maxDP); const maxLength = Math.max(numAStr.length, numBStr.length, sumStr.length + 2); const line = '-'.repeat(maxLength); algorithmDisplay3.textContent = `${numAStr.padStart(maxLength)}\n${`+ ${numBStr}`.padStart(maxLength)}\n${line}\n${sumStr.padStart(maxLength)}`; fractionProblemDisplay3.innerHTML = `${valA} + ${valB} = <span class="fraction"><span>${intA}</span><span class="denominator">${commonDenominator}</span></span> + <span class="fraction"><span>${intB}</span><span class="denominator">${commonDenominator}</span></span> = <span class="fraction"><span>${numeratorSum}</span><span class="denominator">${commonDenominator}</span></span> = <span class="fraction"><span>${simplifiedNumerator}</span><span class="denominator">${simplifiedDenominator}</span></span>`; resultDisplay3.textContent = decimalSum.toLocaleString(undefined, {maximumFractionDigits: 10}); resultFractionDisplay3.innerHTML = `<span class="fraction"><span>${simplifiedNumerator}</span><span class="denominator">${simplifiedDenominator}</span></span>`; }
        if(decimalInputA) decimalInputA.addEventListener('input', updateSimulation3);
        if(decimalInputB) decimalInputB.addEventListener('input', updateSimulation3);


        // --- Simulation 4: Multiplying Decimals ---
        const decimalInputC = document.getElementById('decimalInputC');
        const decimalInputD = document.getElementById('decimalInputD');
        function updateSimulation4() { const algorithmDisplay4 = document.getElementById('algorithmDisplay4'); const fractionProblemDisplay4 = document.getElementById('fractionProblemDisplay4'); const resultDisplay4 = document.getElementById('resultDisplay4'); const resultFractionDisplay4 = document.getElementById('resultFractionDisplay4'); const sim4ErrorMsg = document.getElementById('sim4ErrorMsg'); if (!decimalInputC || !decimalInputD || !sim4ErrorMsg || !algorithmDisplay4 || !fractionProblemDisplay4 || !resultDisplay4 || !resultFractionDisplay4) return; sim4ErrorMsg.textContent = ''; const valC = decimalInputC.value.trim(); const valD = decimalInputD.value.trim(); if (valC === '' || valD === '') { algorithmDisplay4.textContent = ''; fractionProblemDisplay4.textContent = ''; resultDisplay4.textContent = '-'; resultFractionDisplay4.textContent = '-/-'; return; } const numC = parseFloat(valC); const numD = parseFloat(valD); if (isNaN(numC) || isNaN(numD)) { sim4ErrorMsg.textContent = 'Please enter valid decimal numbers.'; algorithmDisplay4.textContent = ''; fractionProblemDisplay4.textContent = ''; resultDisplay4.textContent = '-'; resultFractionDisplay4.textContent = '-/-'; return; } const decimalProduct = numC * numD; const dpC = getDecimalPlaces(valC); const dpD = getDecimalPlaces(valD); const totalDP = dpC + dpD; const denominatorC = Math.pow(10, dpC); const denominatorD = Math.pow(10, dpD); const numeratorC = Math.round(numC * denominatorC); const numeratorD = Math.round(numD * denominatorD); const resultNumerator = numeratorC * numeratorD; const resultDenominator = denominatorC * denominatorD; const commonDivisor = gcd(resultNumerator, resultDenominator); const simplifiedNumerator = resultNumerator / commonDivisor; const simplifiedDenominator = resultDenominator / commonDivisor; const numCStr = valC; const numDStr = valD; const productStr = decimalProduct.toLocaleString(undefined, {maximumFractionDigits: totalDP + 2, useGrouping: false}); const maxLength = Math.max(numCStr.length, numDStr.length + 2, productStr.length); const line = '-'.repeat(maxLength); algorithmDisplay4.textContent = `${numCStr.padStart(maxLength)}  (${dpC} decimal place${dpC === 1 ? '' : 's'})\n${`x ${numDStr}`.padStart(maxLength)} (${dpD} decimal place${dpD === 1 ? '' : 's'})\n${line}\n${productStr.padStart(maxLength)} (${totalDP} decimal place${totalDP === 1 ? '' : 's'})`; fractionProblemDisplay4.innerHTML = `${valC} x ${valD} = <span class="fraction"><span>${numeratorC}</span><span class="denominator">${denominatorC}</span></span> x <span class="fraction"><span>${numeratorD}</span><span class="denominator">${denominatorD}</span></span> = <span class="fraction"><span>${resultNumerator}</span><span class="denominator">${resultDenominator}</span></span> = <span class="fraction"><span>${simplifiedNumerator}</span><span class="denominator">${simplifiedDenominator}</span></span>`; resultDisplay4.textContent = productStr; resultFractionDisplay4.innerHTML = `<span class="fraction"><span>${simplifiedNumerator}</span><span class="denominator">${simplifiedDenominator}</span></span>`; }
        if(decimalInputC) decimalInputC.addEventListener('input', updateSimulation4);
        if(decimalInputD) decimalInputD.addEventListener('input', updateSimulation4);


        // --- Simulation 5: Dividing Decimals ---
        const decimalInputE = document.getElementById('decimalInputE'); // Dividend
        const decimalInputF = document.getElementById('decimalInputF'); // Divisor
        const algorithmDisplay5 = document.getElementById('algorithmDisplay5');
        const fractionProblemDisplay5 = document.getElementById('fractionProblemDisplay5');
        const resultDisplay5 = document.getElementById('resultDisplay5');
        const resultFractionDisplay5 = document.getElementById('resultFractionDisplay5');
        const sim5ErrorMsg = document.getElementById('sim5ErrorMsg');
        const roundingNote5 = document.getElementById('roundingNote5');


        function updateSimulation5() {
             if (!decimalInputE || !decimalInputF || !sim5ErrorMsg || !algorithmDisplay5 || !fractionProblemDisplay5 || !resultDisplay5 || !resultFractionDisplay5 || !roundingNote5) {
                 console.error("One or more elements for Simulation 5 not found.");
                 return;
             }

             sim5ErrorMsg.textContent = '';
             roundingNote5.textContent = ''; // Clear rounding note
             const valE = decimalInputE.value.trim(); // Dividend
             const valF = decimalInputF.value.trim(); // Divisor

             // Validation
             if (valE === '' || valF === '') {
                  algorithmDisplay5.textContent = ''; fractionProblemDisplay5.textContent = ''; resultDisplay5.textContent = '-'; resultFractionDisplay5.textContent = '-/-';
                 return;
             }
             const numE = parseFloat(valE);
             const numF = parseFloat(valF);

             if (isNaN(numE) || isNaN(numF)) {
                 sim5ErrorMsg.textContent = 'Please enter valid decimal numbers.';
                 algorithmDisplay5.textContent = ''; fractionProblemDisplay5.textContent = ''; resultDisplay5.textContent = '-'; resultFractionDisplay5.textContent = '-/-';
                 return;
             }
             if (numF === 0) {
                 sim5ErrorMsg.textContent = 'Division by zero is not allowed.';
                 algorithmDisplay5.textContent = 'Error: Division by zero'; fractionProblemDisplay5.textContent = 'Error: Division by zero'; resultDisplay5.textContent = 'Error'; resultFractionDisplay5.textContent = 'Error';
                 return;
             }

             // 1. Decimal Calculation
             const decimalQuotient = numE / numF;
             const maxDisplayDigits = 10; // Limit display precision
             let decimalQuotientStr = decimalQuotient.toLocaleString(undefined, {maximumFractionDigits: maxDisplayDigits, useGrouping: false});


             // 2. Fraction Calculation
             const dpE = getDecimalPlaces(valE);
             const dpF = getDecimalPlaces(valF);
             let denominatorE = Math.pow(10, dpE);
             let numeratorE = Math.round(numE * denominatorE);
             let denominatorF = Math.pow(10, dpF);
             let numeratorF = Math.round(numF * denominatorF);
             if (numeratorF === 0) { sim5ErrorMsg.textContent = 'Internal error: Divisor fraction numerator is zero.'; return; }
             const resultNumerator = numeratorE * denominatorF;
             const resultDenominator = denominatorE * numeratorF;
             const commonDivisor = gcd(resultNumerator, resultDenominator);
             const simplifiedNumerator = resultNumerator / commonDivisor;
             const simplifiedDenominator = resultDenominator / commonDivisor;

             // Check for rounding
             const preciseFractionValue = simplifiedNumerator / simplifiedDenominator;
             if (Math.abs(decimalQuotient - preciseFractionValue) > 1e-12) {
                 decimalQuotientStr = preciseFractionValue.toLocaleString(undefined, {maximumFractionDigits: maxDisplayDigits, useGrouping: false});
                 if (getDecimalPlaces(decimalQuotientStr) === maxDisplayDigits) {
                     roundingNote5.textContent = '(Decimal result possibly rounded)';
                 }
             }


             // 3. Format Algorithm Display
             const dpShift = dpF;
             const shiftedDividend = numE * Math.pow(10, dpShift);
             const shiftedDivisor = numF * Math.pow(10, dpShift);

             algorithmDisplay5.textContent =
                 `Problem: ${valE} ÷ ${valF}\n\n` +
                 `1. Make divisor whole: Move decimal ${dpShift} place(s) right in ${valF} -> ${shiftedDivisor}\n` +
                 `2. Move decimal same places in dividend: ${valE} -> ${shiftedDividend.toLocaleString(undefined, {useGrouping: false})}\n` +
                 `3. New problem: ${shiftedDividend.toLocaleString(undefined, {useGrouping: false})} ÷ ${shiftedDivisor}\n` +
                 `4. Perform division.\n` +
                 `   Result = ${decimalQuotientStr}`;


             // 4. Format Fraction Display
             const fracEStr = `${numeratorE}/${denominatorE}`;
             const fracFStr = `${numeratorF}/${denominatorF}`;
             const reciprocalFStr = `${denominatorF}/${numeratorF}`;
             const fracProdStr = `${resultNumerator}/${resultDenominator}`;
             const simplifiedFracStr = simplifiedDenominator === 1 ? `${simplifiedNumerator}` : `${simplifiedNumerator}/${simplifiedDenominator}`;

             fractionProblemDisplay5.innerHTML = `
                 ${valE} ÷ ${valF} =
                 <span class="fraction"><span>${numeratorE}</span><span class="denominator">${denominatorE}</span></span> ÷
                 <span class="fraction"><span>${numeratorF}</span><span class="denominator">${denominatorF}</span></span> = <br>
                 <span class="fraction"><span>${numeratorE}</span><span class="denominator">${denominatorE}</span></span> x
                 <span class="fraction"><span>${denominatorF}</span><span class="denominator">${numeratorF}</span></span> = <span class="fraction"><span>${resultNumerator}</span><span class="denominator">${resultDenominator}</span></span> =
                 <span class="fraction"><span>${simplifiedNumerator}</span><span class="denominator">${simplifiedDenominator}</span></span>
             `;

             // 5. Update Result Display
             resultDisplay5.textContent = decimalQuotientStr;
             resultFractionDisplay5.innerHTML = `<span class="fraction"><span>${simplifiedNumerator}</span><span class="denominator">${simplifiedDenominator}</span></span>`;
        }


        // --- Sim 5 Event Listeners ---
        if (decimalInputE) decimalInputE.addEventListener('input', updateSimulation5);
        if (decimalInputF) decimalInputF.addEventListener('input', updateSimulation5);


        // --- Set Copyright Year & Initial Load ---
        window.addEventListener('load', () => {
            // Set copyright year
            const yearSpan = document.getElementById('copyright-year');
            if (yearSpan) {
                yearSpan.textContent = new Date().getFullYear();
            }

            // Run initial calculations for all simulations
            if(slider) { drawRuler(); drawPieSlices(); updateSim1Values(); }
            if (numeratorInput2 && denominatorInput2) updateSimulation2();
            if (decimalInputA && decimalInputB) updateSimulation3();
            if (decimalInputC && decimalInputD) updateSimulation4();
            if (decimalInputE && decimalInputF) updateSimulation5();
        });
        window.addEventListener('resize', () => {
            // Redraw/recalculate on resize
            if(slider) drawRuler();
            if (numeratorInput2 && denominatorInput2) updateSimulation2();
            if (decimalInputA && decimalInputB) updateSimulation3();
            if (decimalInputC && decimalInputD) updateSimulation4();
            if (decimalInputE && decimalInputF) updateSimulation5();
        });

    </script>

</body>
</html>
