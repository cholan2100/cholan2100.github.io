<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Computer Simulation</title>
    <style>
        :root {
            --bg-color: #ffffff;        /* White background for light mode */
            --text-color: #000000;      /* Black text for light mode */
            --border-color: #333333;    /* Dark gray borders */
            --table-bg: #ffffff;        /* White table background */
            --table-border: #333333;    /* Dark gray table borders */
            --active-row: #ffff99;      /* Light yellow for active row */
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #1a1a1a;    /* Dark gray background for dark mode */
                --text-color: #ffffff;  /* White text for dark mode */
                --border-color: #cccccc;/* Light gray borders */
                --table-bg: #333333;    /* Darker gray table background */
                --table-border: #cccccc;/* Light gray table borders */
                --active-row: #444444;  /* Medium gray for active row */
            }
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
        }

        #canvas-container {
            width: 800px;
            height: 400px;
            margin: 20px auto;
            position: relative;
        }

        canvas {
            border: 1px solid var(--border-color);
        }

        #simulation-container {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        #memory-container, #processor-container, #monitor-container {
            width: 200px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            background-color: var(--table-bg);
        }

        th, td {
            border: 1px solid var(--table-border);
            padding: 5px;
            text-align: left;
            color: var(--text-color);
        }

        .active {
            background-color: var(--active-row);
        }

        #status {
            margin-top: 20px;
            font-weight: bold;
            color: var(--text-color);
        }

        button {
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
        }

        #output {
            border: 1px solid var(--border-color);
            padding: 10px;
            min-height: 20px;
            background-color: var(--table-bg);
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <h1>Computer System Simulation</h1>
    <div id="canvas-container">
        <canvas id="computerCanvas" width="800" height="400"></canvas>
    </div>
    <div id="simulation-container">
        <div id="memory-container">
            <h2>Memory</h2>
            <table id="memory">
                <tr><th>Address</th><th>Instruction</th></tr>
                <tr id="mem0"><td>0</td><td>LOAD R1, 5</td></tr>
                <tr id="mem1"><td>1</td><td>LOAD R2, 10</td></tr>
                <tr id="mem2"><td>2</td><td>ADD R3, R1, R2</td></tr>
                <tr id="mem3"><td>3</td><td>DISPLAY R3</td></tr>
            </table>
        </div>
        <div id="processor-container">
            <h2>Processor</h2>
            <div>PC: <span id="pc">0</span></div>
            <div>R1: <span id="r1">0</span></div>
            <div>R2: <span id="r2">0</span></div>
            <div>R3: <span id="r3">0</span></div>
            <div>Current Instruction: <span id="instr"></span></div>
        </div>
        <div id="monitor-container">
            <h2>Monitor</h2>
            <div id="output"></div>
        </div>
    </div>
    <div id="status"></div>
    <button onclick="clockCycle()">Next Cycle</button>

    <script>
        // Canvas setup
        const canvas = document.getElementById('computerCanvas');
        const ctx = canvas.getContext('2d');

        // Component positions and sizes
        const memory = { x: 50, y: 100, width: 80, height: 200 };
        const processor = { x: 350, y: 150, width: 100, height: 100 };
        const monitor = { x: 650, y: 100, width: 100, height: 200 };

        // Draw the computer layout
        function drawComputerLayout() {
            const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const colors = {
                memory: isDarkMode ? '#4682B4' : '#87CEEB',      /* Steel blue vs sky blue */
                processor: isDarkMode ? '#2E8B57' : '#90EE90',   /* Sea green vs light green */
                monitor: isDarkMode ? '#808000' : '#FFFFE0',     /* Olive vs light yellow */
                screen: isDarkMode ? '#333333' : '#D3D3D3',      /* Dark gray vs light gray */
                processorDetail: isDarkMode ? '#999999' : '#666666', /* Light gray vs medium gray */
                bus: isDarkMode ? '#ffffff' : '#000000',         /* White vs black */
                text: isDarkMode ? '#ffffff' : '#000000'         /* White vs black */
            };

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw Memory
            ctx.fillStyle = colors.memory;
            ctx.fillRect(memory.x, memory.y, memory.width, memory.height);
            ctx.strokeStyle = colors.bus;
            ctx.strokeRect(memory.x, memory.y, memory.width, memory.height);
            ctx.fillStyle = colors.text;
            ctx.font = '16px Arial';
            ctx.fillText('Memory', memory.x + 10, memory.y - 10);

            // Draw Processor
            ctx.fillStyle = colors.processor;
            ctx.fillRect(processor.x, processor.y, processor.width, processor.height);
            ctx.strokeRect(processor.x, processor.y, processor.width, processor.height);
            ctx.fillStyle = colors.text;
            ctx.fillText('Processor', processor.x + 10, processor.y - 10);
            ctx.strokeStyle = colors.processorDetail;
            ctx.strokeRect(processor.x + 10, processor.y + 10, 80, 80);

            // Draw Monitor
            ctx.fillStyle = colors.monitor;
            ctx.fillRect(monitor.x, monitor.y, monitor.width, monitor.height);
            ctx.strokeRect(monitor.x, monitor.y, monitor.width, monitor.height);
            ctx.fillStyle = colors.text;
            ctx.fillText('Monitor', monitor.x + 10, monitor.y - 10);
            ctx.fillStyle = colors.screen;
            ctx.fillRect(monitor.x + 10, monitor.y + 20, 80, 160);

            // Draw Bus Lines
            ctx.strokeStyle = colors.bus;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(memory.x + memory.width, memory.y + memory.height / 2);
            ctx.lineTo(processor.x, processor.y + processor.height / 2);
            ctx.moveTo(processor.x + processor.width, processor.y + processor.height / 2);
            ctx.lineTo(monitor.x, monitor.y + monitor.height / 2);
            ctx.stroke();
        }

        // Initial draw
        drawComputerLayout();

        // Listen for theme changes
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        mediaQuery.addEventListener('change', () => {
            drawComputerLayout();
        });

        // Simulation logic
        let memoryInstructions = [
            "LOAD R1, 5",
            "LOAD R2, 10",
            "ADD R3, R1, R2",
            "DISPLAY R3"
        ];
        let pc = 0; // Program Counter
        let registers = { R1: 0, R2: 0, R3: 0 }; // Registers

        // Fetch instruction
        function fetch() {
            if (pc < memoryInstructions.length) {
                let instr = memoryInstructions[pc];
                document.getElementById("instr").textContent = instr;
                document.querySelectorAll("#memory tr").forEach(row => row.classList.remove("active"));
                document.getElementById("mem" + pc).classList.add("active");
                document.getElementById("status").textContent = "Fetching instruction from address " + pc;
                return instr;
            }
            return null;
        }

        // Execute instruction
        function execute(instr) {
            let parts = instr.split(" ");
            let opcode = parts[0];
            if (opcode === "LOAD") {
                let reg = parts[1].replace(",", "");
                let value = parseInt(parts[2]);
                registers[reg] = value;
                document.getElementById("status").textContent = `Loading ${value} into ${reg}`;
            } else if (opcode === "ADD") {
                let regDest = parts[1].replace(",", "");
                let reg1 = parts[2].replace(",", "");
                let reg2 = parts[3];
                registers[regDest] = registers[reg1] + registers[reg2];
                document.getElementById("status").textContent = `Adding ${registers[reg1]} and ${registers[reg2]}, storing in ${regDest}`;
            } else if (opcode === "DISPLAY") {
                let reg = parts[1];
                document.getElementById("output").textContent = registers[reg];
                document.getElementById("status").textContent = `Displaying ${registers[reg]} on monitor`;
            }
            // Update register displays
            document.getElementById("r1").textContent = registers.R1;
            document.getElementById("r2").textContent = registers.R2;
            document.getElementById("r3").textContent = registers.R3;
        }

        // Clock cycle
        function clockCycle() {
            let instr = fetch();
            if (instr) {
                execute(instr);
                pc++;
                document.getElementById("pc").textContent = pc;
            } else {
                document.getElementById("status").textContent = "Program finished";
                alert("Program finished");
            }
        }
    </script>
</body>
</html>